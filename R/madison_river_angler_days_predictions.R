
library(dplyr)
library(ggplot2)
library(mgcv)

# From 2020 survey: totals and summer
# .58 is proportion of users who use "upper" river
total_angler_days <- 77453
summer_angler_days <- 58716

summer_angler_days*.58

actual <- data_frame(
  year = c(2011, 2013, 2015, 2016), 
  angler_days = c(90000, 135000, 155000, 180000)) %>%
  mutate(type = 'actual')

actual

mod <- lm(angler_days~year, data = actual)
summary(mod)

actual <- cbind(actual, predict(mod, interval = 'confidence'))
actual


future <- data.frame(
  year = seq(2016, 2040, by = 1), 
  angler_days = NA, 
  type = 'predicted')
future

predicted = cbind(future, predict(mod, newdata = future, interval = 'prediction'))

all <- 
  actual %>%
  rbind(predicted)

all %>%
  mutate(upper_madison = fit*.58, 
         upper_madison_summer = upper_madison*.75)

all %>%
  ggplot() +
  aes(x = year, y = fit, colour = type) +
  geom_line() +
  geom_ribbon(aes(ymin = lwr, ymax = upr), alpha = 0.3)

# # create and summarise model
# cars.model <- lm(dist ~ speed, data = cars)
# summary(cars.model) 
# 
# # add 'fit', 'lwr', and 'upr' columns to dataframe (generated by predict)
# cars.predict <- cbind(cars, predict(cars.model, interval = 'confidence'))
# 
# # plot the points (actual observations), regression line, and confidence interval
# p <- ggplot(cars.predict, aes(speed,dist))
# p <- p + geom_point()
# p <- p + geom_line(aes(speed, fit))
# p <- p + geom_ribbon(aes(ymin=lwr,ymax=upr), alpha=0.3)
# p

x <- rnorm(15)
y <- x + rnorm(15)
predict(lm(y ~ x))
new <- data.frame(x = seq(-3, 3, 0.5))
predict(lm(y ~ x), new, se.fit = TRUE)
pred.w.plim <- predict(lm(y ~ x), new, interval = "prediction")
pred.w.clim <- predict(lm(y ~ x), new, interval = "confidence")
matplot(new$x, cbind(pred.w.clim, pred.w.plim[,-1]),
        lty = c(1,2,2,3,3), type = "l", ylab = "predicted y")